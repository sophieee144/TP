<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QCM Application</title>
    <link rel="stylesheet" href="QCM.css" />
  </head>
  <body>
    <div class="container">
      <h1>QCM Quiz</h1>
      <div id="question-container"></div>
      <button id="next-button" style="display: none">Next Question</button>
    </div>

    <script>
      let currentQuestionIndex = 0;

      function loadQuestion() {
        fetch(`/question/${currentQuestionIndex}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Question not found");
            }
            return response.json();
          })
          .then((data) => {
            const questionContainer =
              document.getElementById("question-container");
            questionContainer.innerHTML = `
                        <h2>${data.question}</h2>
                        <form id="answer-form">
                            ${data.answers
                              .map(
                                (answer, index) => `
                                <div>
                                    <input type="radio" name="answer" value="${index}" id="answer${index}" required>
                                    <label for="answer${index}">${answer}</label>
                                </div>
                            `
                              )
                              .join("")}
                            <button type="submit" id="submit-button">Submit Answer</button>
                        </form>
                    `;
          })
          .catch((error) => {
            document.getElementById(
              "question-container"
            ).innerHTML = `<h2>${error.message}</h2>`;
          });
      }

      document.addEventListener("submit", function (event) {
        if (event.target.id === "answer-form") {
          event.preventDefault();
          const selectedAnswer = document.querySelector(
            'input[name="answer"]:checked'
          );
          const answerValue = selectedAnswer.value;

          fetch(`/check-answer/${currentQuestionIndex}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ answer: answerValue }),
          })
            .then((response) => response.json())
            .then((result) => {
              if (result.correct) {
                alert("Correct answer! Moving to the next question.");
                currentQuestionIndex++;
                loadQuestion();
              } else {
                alert("Incorrect answer. Please try again.");
              }
            });
        }
      });

      // Load the first question when the page loads
      loadQuestion();
    </script>
  </body>
</html>
